🧠 Avvio training CalciumVQVAE con W&B logging...
Using device: cuda
📊 Caricamento dataset Allen Brain...
🧠 Loading Allen Brain Observatory data for reconstruction...
Using session: 501474098
🔍 Extracting data directly from HDF5 for session 501474098...
   📁 NWB file path: C:\Users\Claudio\Desktop\Tesi VQVAE 1\brain_observatory\ophys_experiment_data\501474098.nwb
   ✅ Found running speed data in HDF5
   📊 Speed data shape: (105578,)
   📈 Speed range: -19.410 - 34.635
   ✅ Valid speed data: 99.9% (105434/105578)
   ✅ Found neural data in HDF5
   🔄 Transposed DFF data for correct alignment
   📊 DFF data shape: (105743, 108)
   🔧 Preprocessing neural data...
  ✅ Successfully extracted neural data from HDF5!
  🔄 Transposed DFF traces to (neurons, time)
  📊 Final neural data shape: (108, 105743)
  📊 Neuron selection stats:
     Mean correlation: 0.073
     Mean variance: 0.163
  ✅ Selected 30 active neurons
📊 Final dataset: 10570 windows
   Neural data shape: torch.Size([10570, 30, 50])
Dataset caricato: 10570 campioni
Split: 7398 train, 3172 test
🏗️  Creazione modello...
Modello creato con 212,158 parametri
🚀 Inizio training...
Epoch   0: Train Loss=1.0304 | Test MSE=0.9385, MAE=0.3874, Corr=0.2117
Epoch   5: Train Loss=1.1634 | Test MSE=0.8079, MAE=0.3707, Corr=0.4037
Epoch  10: Train Loss=1.0952 | Test MSE=0.7464, MAE=0.3613, Corr=0.4676
Epoch  15: Train Loss=1.0460 | Test MSE=0.6942, MAE=0.3482, Corr=0.5062
Epoch  20: Train Loss=1.1412 | Test MSE=0.6488, MAE=0.3420, Corr=0.5406
Epoch  25: Train Loss=0.8956 | Test MSE=0.6032, MAE=0.3280, Corr=0.5709
Epoch  30: Train Loss=0.8525 | Test MSE=0.5908, MAE=0.3321, Corr=0.5930
Epoch  35: Train Loss=0.7938 | Test MSE=0.5635, MAE=0.3270, Corr=0.6145
Epoch  40: Train Loss=0.7655 | Test MSE=0.5420, MAE=0.3230, Corr=0.6356
Epoch  45: Train Loss=0.7334 | Test MSE=0.5231, MAE=0.3185, Corr=0.6508
Epoch  50: Train Loss=0.7265 | Test MSE=0.5062, MAE=0.3186, Corr=0.6627
Epoch  55: Train Loss=0.7375 | Test MSE=0.4814, MAE=0.3166, Corr=0.6899
Epoch  60: Train Loss=0.8045 | Test MSE=0.4799, MAE=0.3156, Corr=0.6943
Epoch  65: Train Loss=0.7899 | Test MSE=0.4622, MAE=0.3119, Corr=0.7180
Epoch  70: Train Loss=0.7307 | Test MSE=0.4391, MAE=0.3078, Corr=0.7339
Epoch  75: Train Loss=0.7210 | Test MSE=0.4205, MAE=0.3039, Corr=0.7464
Epoch  80: Train Loss=0.6701 | Test MSE=0.4061, MAE=0.2992, Corr=0.7548
Epoch  85: Train Loss=0.6371 | Test MSE=0.3991, MAE=0.2986, Corr=0.7583
Epoch  90: Train Loss=0.6492 | Test MSE=0.3981, MAE=0.2953, Corr=0.7617
Epoch  95: Train Loss=0.6203 | Test MSE=0.3910, MAE=0.2943, Corr=0.7656

🎯 VALUTAZIONE FINALE:
MSE finale: 0.388651
MAE finale: 0.293379
Correlazione media: 0.766313
Correlazione min/max: 0.079 / 0.906
Neuroni con corr > 0.5: 28/30 (93.3%)
